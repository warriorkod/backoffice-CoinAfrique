import { Observable, from } from 'rxjs';
import { Injectable, NgModule, defineInjectable } from '@angular/core';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ResizeOptions = /** @class */ (function () {
    function ResizeOptions() {
        this.Resize_Max_Height = 800;
        this.Resize_Max_Width = 1000;
        this.Resize_Quality = 70;
        this.Resize_Type = 'image/jpg';
    }
    return ResizeOptions;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var SourceImage = /** @class */ (function () {
    function SourceImage() {
    }
    return SourceImage;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ImageUtilityService = /** @class */ (function () {
    function ImageUtilityService() {
    }
    /**
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    ImageUtilityService.createImage = /**
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    function (url, callback) {
        /** @type {?} */
        var image = new Image();
        image.onload = function () {
            callback(image);
        };
        image.src = url;
    };
    /**
     * @param {?} file
     * @return {?}
     */
    ImageUtilityService.fileToDataURL = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        return new Promise(function (resolve) {
            /** @type {?} */
            var reader = new FileReader();
            reader.onload = function (e) {
                resolve(e.target.result);
            };
            reader.readAsDataURL(file);
        });
    };
    /**
     * @param {?} fileList
     * @return {?}
     */
    ImageUtilityService.filesToSourceImages = /**
     * @param {?} fileList
     * @return {?}
     */
    function (fileList) {
        return Observable.create(function (observer) {
            /** @type {?} */
            var total = fileList.length;
            Array.from(fileList).forEach(function (fileItem) {
                /** @type {?} */
                var imageResult = new SourceImage();
                console.log(fileItem.name);
                imageResult.fileName = fileItem.name;
                imageResult.type = fileItem.type;
                imageResult.imageObjectUrl = URL.createObjectURL(fileItem);
                ImageUtilityService.fileToDataURL(fileItem).then(function (result) {
                    imageResult.imageDataUrl = result;
                    observer.next(imageResult);
                    if (--total === 0)
                        observer.complete();
                });
            });
        });
    };
    /**
     * @param {?} fileList
     * @return {?}
     */
    ImageUtilityService.filesArrayToSourceImages = /**
     * @param {?} fileList
     * @return {?}
     */
    function (fileList) {
        return Observable.create(function (observer) {
            /** @type {?} */
            var total = fileList.length;
            fileList.forEach(function (fileItem) {
                /** @type {?} */
                var imageResult = new SourceImage();
                console.log(fileItem.name);
                // imageResult.fileName = fileItem.name;
                imageResult.imageObjectUrl = URL.createObjectURL(fileItem);
                ImageUtilityService.fileToDataURL(fileItem).then(function (result) {
                    imageResult.imageDataUrl = result;
                    observer.next(imageResult);
                    if (--total === 0)
                        observer.complete();
                });
            });
        });
    };
    return ImageUtilityService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ImageCompressService = /** @class */ (function () {
    function ImageCompressService() {
    }
    /**
     * @private
     * @param {?} sourceImgObj
     * @param {?} options
     * @return {?}
     */
    ImageCompressService.jicCompress = /**
     * @private
     * @param {?} sourceImgObj
     * @param {?} options
     * @return {?}
     */
    function (sourceImgObj, options) {
        /** @type {?} */
        var outputFormat = options.Resize_Type;
        /** @type {?} */
        var quality = options.Resize_Quality || 50;
        /** @type {?} */
        var mimeType = 'image/jpeg';
        if (outputFormat !== undefined && outputFormat === 'png') {
            mimeType = 'image/png';
        }
        /** @type {?} */
        var maxHeight = options.Resize_Max_Height || 300;
        /** @type {?} */
        var maxWidth = options.Resize_Max_Width || 250;
        console.log('MAX Width n Height');
        console.log(options.Resize_Max_Height);
        console.log(options.Resize_Max_Width);
        console.log('Quality');
        console.log(quality);
        /** @type {?} */
        var height = sourceImgObj.height;
        /** @type {?} */
        var width = sourceImgObj.width;
        // calculate the width and height, constraining the proportions
        if (width > height) {
            if (width > maxWidth) {
                height = Math.round(height *= maxWidth / width);
                width = maxWidth;
            }
        }
        else {
            if (height > maxHeight) {
                width = Math.round(width *= maxHeight / height);
                height = maxHeight;
            }
        }
        console.log('CVS Width n Height');
        console.log(width);
        console.log(height);
        console.log('Quality');
        console.log(quality);
        /** @type {?} */
        var cvs = document.createElement('canvas');
        cvs.width = width;
        cvs.height = height;
        /** @type {?} */
        var ctx = cvs.getContext('2d').drawImage(sourceImgObj, 0, 0, width, height);
        /** @type {?} */
        var newImageData = cvs.toDataURL(mimeType, quality / 100);
        /** @type {?} */
        var resultImageObj = new Image();
        resultImageObj.src = newImageData;
        return resultImageObj.src;
    };
    /**
     * @param {?} sourceImage
     * @param {?} options
     * @param {?} callback
     * @return {?}
     */
    ImageCompressService.compressImage = /**
     * @param {?} sourceImage
     * @param {?} options
     * @param {?} callback
     * @return {?}
     */
    function (sourceImage, options, callback) {
        /** @type {?} */
        var that = this;
        ImageUtilityService.createImage(sourceImage.imageDataUrl, function (image) {
            /** @type {?} */
            var dataURLcompressed = that.jicCompress(image, options);
            sourceImage.compressedImage = {
                fileName: sourceImage.fileName,
                imageObjectUrl: "",
                imageDataUrl: dataURLcompressed,
                type: dataURLcompressed.match(/:(.+\/.+);/)[1],
                compressedImage: null
            };
            callback(sourceImage);
        });
    };
    /**
     * @param {?} fileList
     * @param {?} option
     * @return {?}
     */
    ImageCompressService.filesToCompressedImageSourceEx = /**
     * @param {?} fileList
     * @param {?} option
     * @return {?}
     */
    function (fileList, option) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = fileList.length;
            /** @type {?} */
            var observer = ImageUtilityService.filesToSourceImages(fileList);
            /** @type {?} */
            var images = [];
            observer.subscribe(function (image) {
                images.push(image);
                if (option == null) {
                    option = new ResizeOptions();
                }
                ImageCompressService.compressImage(image, option, function (imageRef) {
                    if (--count == 0) {
                        resolve(from(images));
                    }
                });
            }, function (error) {
                reject("Error while compressing images");
            });
        });
    };
    /**
     * @param {?} fileList
     * @return {?}
     */
    ImageCompressService.filesToCompressedImageSource = /**
     * @param {?} fileList
     * @return {?}
     */
    function (fileList) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = fileList.length;
            /** @type {?} */
            var observer = ImageUtilityService.filesToSourceImages(fileList);
            /** @type {?} */
            var images = [];
            observer.subscribe(function (image) {
                images.push(image);
                ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                    if (--count == 0) {
                        resolve(from(images));
                    }
                });
            }, function (error) {
                reject("Error while compressing images");
            });
        });
    };
    /**
     * @param {?} fileList
     * @param {?} option
     * @return {?}
     */
    ImageCompressService.filesArrayToCompressedImageSourceEx = /**
     * @param {?} fileList
     * @param {?} option
     * @return {?}
     */
    function (fileList, option) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = fileList.length;
            /** @type {?} */
            var observer = ImageUtilityService.filesArrayToSourceImages(fileList);
            /** @type {?} */
            var images = [];
            observer.subscribe(function (image) {
                images.push(image);
                if (option == null) {
                    option = new ResizeOptions();
                }
                ImageCompressService.compressImage(image, option, function (imageRef) {
                    if (--count == 0) {
                        resolve(from(images));
                    }
                });
            }, function (error) {
                reject("Error while compressing images");
            });
        });
    };
    /**
     * @param {?} fileList
     * @return {?}
     */
    ImageCompressService.filesArrayToCompressedImageSource = /**
     * @param {?} fileList
     * @return {?}
     */
    function (fileList) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = fileList.length;
            /** @type {?} */
            var observer = ImageUtilityService.filesArrayToSourceImages(fileList);
            /** @type {?} */
            var images = [];
            observer.subscribe(function (image) {
                images.push(image);
                ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                    if (--count == 0) {
                        resolve(from(images));
                    }
                });
            }, function (error) {
                reject("Error while compressing images");
            });
        });
    };
    /**
     * @param {?} images
     * @return {?}
     */
    ImageCompressService.IImageListToCompressedImageSource = /**
     * @param {?} images
     * @return {?}
     */
    function (images) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = images.length;
            images.forEach(function (image) {
                ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                    console.log(image);
                    if (--count == 0) {
                        resolve(images);
                    }
                });
            });
        });
    };
    /**
     * @param {?} images
     * @param {?} resizeOption
     * @return {?}
     */
    ImageCompressService.IImageListToCompressedImageSourceEx = /**
     * @param {?} images
     * @param {?} resizeOption
     * @return {?}
     */
    function (images, resizeOption) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var count = images.length;
            images.forEach(function (image) {
                if (resizeOption == null) {
                    resizeOption = new ResizeOptions();
                }
                ImageCompressService.compressImage(image, resizeOption, function (imageRef) {
                    console.log(image);
                    if (--count == 0) {
                        resolve(images);
                    }
                });
            });
        });
    };
    ImageCompressService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */ ImageCompressService.ngInjectableDef = defineInjectable({ factory: function ImageCompressService_Factory() { return new ImageCompressService(); }, token: ImageCompressService, providedIn: "root" });
    return ImageCompressService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var ImageCompressModule = /** @class */ (function () {
    function ImageCompressModule() {
    }
    /**
     * @return {?}
     */
    ImageCompressModule.forRoot = /**
     * @return {?}
     */
    function () {
        return {
            ngModule: ImageCompressModule,
            providers: [ImageCompressService, ImageUtilityService]
        };
    };
    ImageCompressModule.decorators = [
        { type: NgModule, args: [{
                    imports: [],
                    providers: [ImageUtilityService, ImageCompressService]
                },] }
    ];
    return ImageCompressModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

export { ImageCompressService, ImageCompressModule, ResizeOptions, ImageUtilityService, SourceImage };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWltYWdlLWNvbXByZXNzLmpzLm1hcCIsInNvdXJjZXMiOlsibmc6Ly9uZzItaW1hZ2UtY29tcHJlc3MvbGliL1Jlc2l6ZU9wdGlvbnMudHMiLCJuZzovL25nMi1pbWFnZS1jb21wcmVzcy9saWIvQ29tcHJlc3NJbWFnZS50cyIsIm5nOi8vbmcyLWltYWdlLWNvbXByZXNzL2xpYi9pbWFnZVV0aWxpdHlTZXJ2aWNlLnRzIiwibmc6Ly9uZzItaW1hZ2UtY29tcHJlc3MvbGliL25nMi1pbWFnZS1jb21wcmVzcy5zZXJ2aWNlLnRzIiwibmc6Ly9uZzItaW1hZ2UtY29tcHJlc3MvbGliL25nMi1pbWFnZS1jb21wcmVzcy5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFJlc2l6ZU9wdGlvbnMge1xyXG4gICAgcHVibGljIFJlc2l6ZV9NYXhfSGVpZ2h0ID0gODAwO1xyXG4gICAgcHVibGljIFJlc2l6ZV9NYXhfV2lkdGggPSAxMDAwO1xyXG4gICAgcHVibGljIFJlc2l6ZV9RdWFsaXR5ID0gNzA7XHJcbiAgICBwdWJsaWMgUmVzaXplX1R5cGUgPSAnaW1hZ2UvanBnJztcclxufVxyXG4iLCJleHBvcnQgaW50ZXJmYWNlIElJbWFnZXtcclxuICAgIGZpbGVOYW1lOnN0cmluZ1xyXG4gICAgaW1hZ2VPYmplY3RVcmw6c3RyaW5nXHJcbiAgICBpbWFnZURhdGFVcmw6c3RyaW5nXHJcbiAgICB0eXBlOnN0cmluZ1xyXG4gICAgY29tcHJlc3NlZEltYWdlOklJbWFnZVxyXG59XHJcblxyXG5leHBvcnQgIGNsYXNzIFNvdXJjZUltYWdlIGltcGxlbWVudHMgSUltYWdle1xyXG4gICAgcHVibGljIGZpbGVOYW1lOnN0cmluZztcclxuICAgIHB1YmxpYyBpbWFnZU9iamVjdFVybDpzdHJpbmc7XHJcbiAgICBwdWJsaWMgaW1hZ2VEYXRhVXJsOnN0cmluZztcclxuICAgIHB1YmxpYyB0eXBlOnN0cmluZztcclxuICAgIHB1YmxpYyBjb21wcmVzc2VkSW1hZ2U6SUltYWdlXHJcbn1cclxuIiwiaW1wb3J0IHsgU291cmNlSW1hZ2UsIElJbWFnZSB9IGZyb20gXCIuL0NvbXByZXNzSW1hZ2VcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IE9ic2VydmVyIH0gZnJvbSBcInJ4anNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBJbWFnZVV0aWxpdHlTZXJ2aWNlIHtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGNyZWF0ZUltYWdlKHVybCwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGltYWdlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGltYWdlLnNyYyA9IHVybDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbGVUb0RhdGFVUkwoZmlsZSk6IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGUudGFyZ2V0LnJlc3VsdCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZmlsZXNUb1NvdXJjZUltYWdlcyhmaWxlTGlzdDogRmlsZUxpc3QpOiBPYnNlcnZhYmxlPElJbWFnZT4ge1xyXG5cclxuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoKG9ic2VydmVyOiBPYnNlcnZlcjxJSW1hZ2U+KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB0b3RhbCA9IGZpbGVMaXN0Lmxlbmd0aDtcclxuICAgICAgICAgICAgQXJyYXkuZnJvbShmaWxlTGlzdCkuZm9yRWFjaChmaWxlSXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW1hZ2VSZXN1bHQ6IElJbWFnZSA9IG5ldyBTb3VyY2VJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZmlsZUl0ZW0ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGltYWdlUmVzdWx0LmZpbGVOYW1lID0gZmlsZUl0ZW0ubmFtZTtcclxuICAgICAgICAgICAgICAgIGltYWdlUmVzdWx0LnR5cGUgPSBmaWxlSXRlbS50eXBlO1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VSZXN1bHQuaW1hZ2VPYmplY3RVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGVJdGVtKTtcclxuICAgICAgICAgICAgICAgIEltYWdlVXRpbGl0eVNlcnZpY2UuZmlsZVRvRGF0YVVSTChmaWxlSXRlbSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VSZXN1bHQuaW1hZ2VEYXRhVXJsID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaW1hZ2VSZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgtLXRvdGFsID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZmlsZXNBcnJheVRvU291cmNlSW1hZ2VzKGZpbGVMaXN0OiBGaWxlW10pOiBPYnNlcnZhYmxlPElJbWFnZT4ge1xyXG5cclxuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoKG9ic2VydmVyOiBPYnNlcnZlcjxJSW1hZ2U+KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB0b3RhbCA9IGZpbGVMaXN0Lmxlbmd0aDtcclxuICAgICAgICAgICAgZmlsZUxpc3QuZm9yRWFjaChmaWxlSXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW1hZ2VSZXN1bHQ6IElJbWFnZSA9IG5ldyBTb3VyY2VJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZmlsZUl0ZW0ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBpbWFnZVJlc3VsdC5maWxlTmFtZSA9IGZpbGVJdGVtLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBpbWFnZVJlc3VsdC5pbWFnZU9iamVjdFVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZUl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgSW1hZ2VVdGlsaXR5U2VydmljZS5maWxlVG9EYXRhVVJMKGZpbGVJdGVtKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZVJlc3VsdC5pbWFnZURhdGFVcmwgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChpbWFnZVJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKC0tdG90YWwgPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7IFxuaW1wb3J0IHsgUmVzaXplT3B0aW9ucyB9IGZyb20gXCIuL1Jlc2l6ZU9wdGlvbnNcIlxuaW1wb3J0IHsgU291cmNlSW1hZ2UsIElJbWFnZSB9IGZyb20gXCIuL0NvbXByZXNzSW1hZ2VcIjtcbmltcG9ydCB7IEltYWdlVXRpbGl0eVNlcnZpY2UgfSBmcm9tIFwiLi9pbWFnZVV0aWxpdHlTZXJ2aWNlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIiBcbmltcG9ydCB7IGZyb20gYXMgT2JzZXJ2YWJsZWZyb219IGZyb20gXCJyeGpzXCI7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuXG5leHBvcnQgY2xhc3MgSW1hZ2VDb21wcmVzc1NlcnZpY2Uge1xuXG4gIFxuXG4gIHByaXZhdGUgc3RhdGljIGppY0NvbXByZXNzKHNvdXJjZUltZ09iaiwgb3B0aW9uczogUmVzaXplT3B0aW9ucykge1xuICAgICAgdmFyIG91dHB1dEZvcm1hdCA9IG9wdGlvbnMuUmVzaXplX1R5cGU7XG4gICAgICB2YXIgcXVhbGl0eSA9IG9wdGlvbnMuUmVzaXplX1F1YWxpdHkgfHwgNTA7XG4gICAgICB2YXIgbWltZVR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gICAgICBpZiAob3V0cHV0Rm9ybWF0ICE9PSB1bmRlZmluZWQgJiYgb3V0cHV0Rm9ybWF0ID09PSAncG5nJykge1xuICAgICAgICAgIG1pbWVUeXBlID0gJ2ltYWdlL3BuZyc7XG4gICAgICB9XG5cblxuICAgICAgdmFyIG1heEhlaWdodCA9IG9wdGlvbnMuUmVzaXplX01heF9IZWlnaHQgfHwgMzAwO1xuICAgICAgdmFyIG1heFdpZHRoID0gb3B0aW9ucy5SZXNpemVfTWF4X1dpZHRoIHx8IDI1MDtcblxuICAgICAgY29uc29sZS5sb2coJ01BWCBXaWR0aCBuIEhlaWdodCcpO1xuICAgICAgY29uc29sZS5sb2cob3B0aW9ucy5SZXNpemVfTWF4X0hlaWdodCk7XG4gICAgICBjb25zb2xlLmxvZyhvcHRpb25zLlJlc2l6ZV9NYXhfV2lkdGgpO1xuICAgICAgY29uc29sZS5sb2coJ1F1YWxpdHknKTtcbiAgICAgIGNvbnNvbGUubG9nKHF1YWxpdHkpO1xuXG4gICAgICB2YXIgaGVpZ2h0ID0gc291cmNlSW1nT2JqLmhlaWdodDtcbiAgICAgIHZhciB3aWR0aCA9IHNvdXJjZUltZ09iai53aWR0aDtcblxuICAgICAgLy8gY2FsY3VsYXRlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0LCBjb25zdHJhaW5pbmcgdGhlIHByb3BvcnRpb25zXG4gICAgICBpZiAod2lkdGggPiBoZWlnaHQpIHtcbiAgICAgICAgICBpZiAod2lkdGggPiBtYXhXaWR0aCkge1xuICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLnJvdW5kKGhlaWdodCAqPSBtYXhXaWR0aCAvIHdpZHRoKTtcbiAgICAgICAgICAgICAgd2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgIHdpZHRoID0gTWF0aC5yb3VuZCh3aWR0aCAqPSBtYXhIZWlnaHQgLyBoZWlnaHQpO1xuICAgICAgICAgICAgICBoZWlnaHQgPSBtYXhIZWlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coJ0NWUyBXaWR0aCBuIEhlaWdodCcpO1xuICAgICAgY29uc29sZS5sb2cod2lkdGgpO1xuICAgICAgY29uc29sZS5sb2coaGVpZ2h0KTtcbiAgICAgIGNvbnNvbGUubG9nKCdRdWFsaXR5Jyk7XG4gICAgICBjb25zb2xlLmxvZyhxdWFsaXR5KTtcblxuICAgICAgdmFyIGN2cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgY3ZzLndpZHRoID0gd2lkdGg7XG4gICAgICBjdnMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgdmFyIGN0eCA9IGN2cy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShzb3VyY2VJbWdPYmosIDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgdmFyIG5ld0ltYWdlRGF0YSA9IGN2cy50b0RhdGFVUkwobWltZVR5cGUsIHF1YWxpdHkgLyAxMDApO1xuICAgICAgdmFyIHJlc3VsdEltYWdlT2JqID0gbmV3IEltYWdlKCk7XG4gICAgICByZXN1bHRJbWFnZU9iai5zcmMgPSBuZXdJbWFnZURhdGE7XG4gICAgICByZXR1cm4gcmVzdWx0SW1hZ2VPYmouc3JjO1xuICB9XG5cbiAgIFxuXG4gIHB1YmxpYyBzdGF0aWMgY29tcHJlc3NJbWFnZShzb3VyY2VJbWFnZTogSUltYWdlLCBvcHRpb25zOiBSZXNpemVPcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgICAgSW1hZ2VVdGlsaXR5U2VydmljZS5jcmVhdGVJbWFnZShzb3VyY2VJbWFnZS5pbWFnZURhdGFVcmwsIGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgICAgIHZhciBkYXRhVVJMY29tcHJlc3NlZCA9IHRoYXQuamljQ29tcHJlc3MoaW1hZ2UsIG9wdGlvbnMpO1xuICAgICAgICAgIHNvdXJjZUltYWdlLmNvbXByZXNzZWRJbWFnZSA9IHtcbiAgICAgICAgICAgICAgZmlsZU5hbWU6IHNvdXJjZUltYWdlLmZpbGVOYW1lLFxuICAgICAgICAgICAgICBpbWFnZU9iamVjdFVybDogXCJcIixcbiAgICAgICAgICAgICAgaW1hZ2VEYXRhVXJsOiBkYXRhVVJMY29tcHJlc3NlZCxcbiAgICAgICAgICAgICAgdHlwZTogZGF0YVVSTGNvbXByZXNzZWQubWF0Y2goLzooLitcXC8uKyk7LylbMV0sXG4gICAgICAgICAgICAgIGNvbXByZXNzZWRJbWFnZTogbnVsbFxuICAgICAgICAgIH07XG4gICAgICAgICAgY2FsbGJhY2soc291cmNlSW1hZ2UpO1xuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGZpbGVzVG9Db21wcmVzc2VkSW1hZ2VTb3VyY2VFeChmaWxlTGlzdDogRmlsZUxpc3QsIG9wdGlvbjogUmVzaXplT3B0aW9ucyk6IFByb21pc2U8T2JzZXJ2YWJsZTxJSW1hZ2U+PiB7XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBsZXQgY291bnQgPSBmaWxlTGlzdC5sZW5ndGg7XG4gICAgICAgICAgbGV0IG9ic2VydmVyID0gSW1hZ2VVdGlsaXR5U2VydmljZS5maWxlc1RvU291cmNlSW1hZ2VzKGZpbGVMaXN0KTtcbiAgICAgICAgICBsZXQgaW1hZ2VzOiBBcnJheTxJSW1hZ2U+ID0gW107XG4gICAgICAgICAgb2JzZXJ2ZXIuc3Vic2NyaWJlKChpbWFnZSkgPT4ge1xuICAgICAgICAgICAgICBpbWFnZXMucHVzaChpbWFnZSk7XG4gICAgICAgICAgICAgIGlmIChvcHRpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgb3B0aW9uID0gbmV3IFJlc2l6ZU9wdGlvbnMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBJbWFnZUNvbXByZXNzU2VydmljZS5jb21wcmVzc0ltYWdlKGltYWdlLCBvcHRpb24sIChpbWFnZVJlZikgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKC0tY291bnQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoT2JzZXJ2YWJsZWZyb20oaW1hZ2VzKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICByZWplY3QoXCJFcnJvciB3aGlsZSBjb21wcmVzc2luZyBpbWFnZXNcIik7XG4gICAgICAgICAgfSlcbiAgICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBmaWxlc1RvQ29tcHJlc3NlZEltYWdlU291cmNlKGZpbGVMaXN0OiBGaWxlTGlzdCk6IFByb21pc2U8T2JzZXJ2YWJsZTxJSW1hZ2U+PiB7XG5cblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPE9ic2VydmFibGU8SUltYWdlPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGxldCBjb3VudCA9IGZpbGVMaXN0Lmxlbmd0aDtcbiAgICAgICAgICBsZXQgb2JzZXJ2ZXIgPSBJbWFnZVV0aWxpdHlTZXJ2aWNlLmZpbGVzVG9Tb3VyY2VJbWFnZXMoZmlsZUxpc3QpO1xuICAgICAgICAgIGxldCBpbWFnZXM6IEFycmF5PElJbWFnZT4gPSBbXTtcbiAgICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoKGltYWdlKSA9PiB7XG4gICAgICAgICAgICAgIGltYWdlcy5wdXNoKGltYWdlKTtcblxuICAgICAgICAgICAgICBJbWFnZUNvbXByZXNzU2VydmljZS5jb21wcmVzc0ltYWdlKGltYWdlLCBuZXcgUmVzaXplT3B0aW9ucygpLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE9ic2VydmFibGVmcm9tKGltYWdlcykpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgcmVqZWN0KFwiRXJyb3Igd2hpbGUgY29tcHJlc3NpbmcgaW1hZ2VzXCIpO1xuICAgICAgICAgIH0pXG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZmlsZXNBcnJheVRvQ29tcHJlc3NlZEltYWdlU291cmNlRXgoZmlsZUxpc3Q6IEZpbGVbXSwgb3B0aW9uOiBSZXNpemVPcHRpb25zKTogUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+IHtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPE9ic2VydmFibGU8SUltYWdlPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGxldCBjb3VudCA9IGZpbGVMaXN0Lmxlbmd0aDtcbiAgICAgICAgICBsZXQgb2JzZXJ2ZXIgPSBJbWFnZVV0aWxpdHlTZXJ2aWNlLmZpbGVzQXJyYXlUb1NvdXJjZUltYWdlcyhmaWxlTGlzdCk7XG4gICAgICAgICAgbGV0IGltYWdlczogQXJyYXk8SUltYWdlPiA9IFtdO1xuICAgICAgICAgIG9ic2VydmVyLnN1YnNjcmliZSgoaW1hZ2UpID0+IHtcbiAgICAgICAgICAgICAgaW1hZ2VzLnB1c2goaW1hZ2UpO1xuICAgICAgICAgICAgICBpZiAob3B0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIG9wdGlvbiA9IG5ldyBSZXNpemVPcHRpb25zKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgb3B0aW9uLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE9ic2VydmFibGVmcm9tKGltYWdlcykpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgcmVqZWN0KFwiRXJyb3Igd2hpbGUgY29tcHJlc3NpbmcgaW1hZ2VzXCIpO1xuICAgICAgICAgIH0pXG4gICAgICB9KTtcbiAgfVxuICBwdWJsaWMgc3RhdGljIGZpbGVzQXJyYXlUb0NvbXByZXNzZWRJbWFnZVNvdXJjZShmaWxlTGlzdDogRmlsZVtdKTogUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+IHtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPE9ic2VydmFibGU8SUltYWdlPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGxldCBjb3VudCA9IGZpbGVMaXN0Lmxlbmd0aDtcbiAgICAgICAgICBsZXQgb2JzZXJ2ZXIgPSBJbWFnZVV0aWxpdHlTZXJ2aWNlLmZpbGVzQXJyYXlUb1NvdXJjZUltYWdlcyhmaWxlTGlzdCk7XG4gICAgICAgICAgbGV0IGltYWdlczogQXJyYXk8SUltYWdlPiA9IFtdO1xuICAgICAgICAgIG9ic2VydmVyLnN1YnNjcmliZSgoaW1hZ2UpID0+IHtcbiAgICAgICAgICAgICAgaW1hZ2VzLnB1c2goaW1hZ2UpO1xuICAgICAgICAgICAgICBJbWFnZUNvbXByZXNzU2VydmljZS5jb21wcmVzc0ltYWdlKGltYWdlLCBuZXcgUmVzaXplT3B0aW9ucygpLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE9ic2VydmFibGVmcm9tKGltYWdlcykpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgcmVqZWN0KFwiRXJyb3Igd2hpbGUgY29tcHJlc3NpbmcgaW1hZ2VzXCIpO1xuICAgICAgICAgIH0pXG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgSUltYWdlTGlzdFRvQ29tcHJlc3NlZEltYWdlU291cmNlKGltYWdlczogSUltYWdlW10pOiBQcm9taXNlPElJbWFnZVtdPiB7XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxJSW1hZ2VbXT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGxldCBjb3VudCA9IGltYWdlcy5sZW5ndGg7XG4gICAgICAgICAgaW1hZ2VzLmZvckVhY2goaW1hZ2UgPT4ge1xuICAgICAgICAgICAgICBJbWFnZUNvbXByZXNzU2VydmljZS5jb21wcmVzc0ltYWdlKGltYWdlLCBuZXcgUmVzaXplT3B0aW9ucygpLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGltYWdlKTtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGltYWdlcyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgSUltYWdlTGlzdFRvQ29tcHJlc3NlZEltYWdlU291cmNlRXgoaW1hZ2VzOiBJSW1hZ2VbXSwgcmVzaXplT3B0aW9uOiBSZXNpemVPcHRpb25zKTogUHJvbWlzZTxJSW1hZ2VbXT4ge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPElJbWFnZVtdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgbGV0IGNvdW50ID0gaW1hZ2VzLmxlbmd0aDtcbiAgICAgICAgICBpbWFnZXMuZm9yRWFjaChpbWFnZSA9PiB7XG4gICAgICAgICAgICAgIGlmIChyZXNpemVPcHRpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgcmVzaXplT3B0aW9uID0gbmV3IFJlc2l6ZU9wdGlvbnMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBJbWFnZUNvbXByZXNzU2VydmljZS5jb21wcmVzc0ltYWdlKGltYWdlLCByZXNpemVPcHRpb24sIChpbWFnZVJlZikgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgaWYgKC0tY291bnQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaW1hZ2VzKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIH0pO1xuICB9XG5cbn1cblxuIiwiaW1wb3J0IHsgTmdNb2R1bGUsTW9kdWxlV2l0aFByb3ZpZGVycyAgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEltYWdlVXRpbGl0eVNlcnZpY2UgfSBmcm9tIFwiLi9pbWFnZVV0aWxpdHlTZXJ2aWNlXCJcbmltcG9ydCB7IEltYWdlQ29tcHJlc3NTZXJ2aWNlIH0gZnJvbSBcIi4vbmcyLWltYWdlLWNvbXByZXNzLnNlcnZpY2VcIlxuXG5ATmdNb2R1bGUoe1xuICBpbXBvcnRzOiBbXG4gIF0sXG4gIHByb3ZpZGVyczogW0ltYWdlVXRpbGl0eVNlcnZpY2UsSW1hZ2VDb21wcmVzc1NlcnZpY2UgXVxufSlcbmV4cG9ydCBjbGFzcyBJbWFnZUNvbXByZXNzTW9kdWxlIHsgXG5cbiAgc3RhdGljIGZvclJvb3QoKTogTW9kdWxlV2l0aFByb3ZpZGVycyB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmdNb2R1bGU6IEltYWdlQ29tcHJlc3NNb2R1bGUsXG4gICAgICAgIHByb3ZpZGVyczogW0ltYWdlQ29tcHJlc3NTZXJ2aWNlLCBJbWFnZVV0aWxpdHlTZXJ2aWNlXVxuICAgIH07XG59XG59XG4iXSwibmFtZXMiOlsiT2JzZXJ2YWJsZWZyb20iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtJQUFBO1FBQ1csc0JBQWlCLEdBQUcsR0FBRyxDQUFDO1FBQ3hCLHFCQUFnQixHQUFHLElBQUksQ0FBQztRQUN4QixtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNwQixnQkFBVyxHQUFHLFdBQVcsQ0FBQztLQUNwQztJQUFELG9CQUFDO0NBQUE7Ozs7Ozs7SUNHRDtLQU1DO0lBQUQsa0JBQUM7Q0FBQTs7Ozs7O0FDZEQ7SUFJQTtLQTJEQzs7Ozs7O0lBekRpQiwrQkFBVzs7Ozs7SUFBekIsVUFBMEIsR0FBRyxFQUFFLFFBQVE7O1lBQy9CLEtBQUssR0FBRyxJQUFJLEtBQUssRUFBRTtRQUN2QixLQUFLLENBQUMsTUFBTSxHQUFHO1lBQ1gsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ25CLENBQUM7UUFDRixLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztLQUNuQjs7Ozs7SUFFYSxpQ0FBYTs7OztJQUEzQixVQUE0QixJQUFJO1FBQzVCLE9BQU8sSUFBSSxPQUFPLENBQU0sVUFBQyxPQUFPOztnQkFDeEIsTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFNO2dCQUM1QixPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUM1QixDQUFDO1lB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