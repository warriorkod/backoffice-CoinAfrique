(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('rxjs'), require('@angular/core')) :
    typeof define === 'function' && define.amd ? define('ng2-image-compress', ['exports', 'rxjs', '@angular/core'], factory) :
    (factory((global['ng2-image-compress'] = {}),global.rxjs,global.ng.core));
}(this, (function (exports,rxjs,i0) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var ResizeOptions = /** @class */ (function () {
        function ResizeOptions() {
            this.Resize_Max_Height = 800;
            this.Resize_Max_Width = 1000;
            this.Resize_Quality = 70;
            this.Resize_Type = 'image/jpg';
        }
        return ResizeOptions;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var SourceImage = /** @class */ (function () {
        function SourceImage() {
        }
        return SourceImage;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var ImageUtilityService = /** @class */ (function () {
        function ImageUtilityService() {
        }
        /**
         * @param {?} url
         * @param {?} callback
         * @return {?}
         */
        ImageUtilityService.createImage = /**
         * @param {?} url
         * @param {?} callback
         * @return {?}
         */
            function (url, callback) {
                /** @type {?} */
                var image = new Image();
                image.onload = function () {
                    callback(image);
                };
                image.src = url;
            };
        /**
         * @param {?} file
         * @return {?}
         */
        ImageUtilityService.fileToDataURL = /**
         * @param {?} file
         * @return {?}
         */
            function (file) {
                return new Promise(function (resolve) {
                    /** @type {?} */
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        resolve(e.target.result);
                    };
                    reader.readAsDataURL(file);
                });
            };
        /**
         * @param {?} fileList
         * @return {?}
         */
        ImageUtilityService.filesToSourceImages = /**
         * @param {?} fileList
         * @return {?}
         */
            function (fileList) {
                return rxjs.Observable.create(function (observer) {
                    /** @type {?} */
                    var total = fileList.length;
                    Array.from(fileList).forEach(function (fileItem) {
                        /** @type {?} */
                        var imageResult = new SourceImage();
                        console.log(fileItem.name);
                        imageResult.fileName = fileItem.name;
                        imageResult.type = fileItem.type;
                        imageResult.imageObjectUrl = URL.createObjectURL(fileItem);
                        ImageUtilityService.fileToDataURL(fileItem).then(function (result) {
                            imageResult.imageDataUrl = result;
                            observer.next(imageResult);
                            if (--total === 0)
                                observer.complete();
                        });
                    });
                });
            };
        /**
         * @param {?} fileList
         * @return {?}
         */
        ImageUtilityService.filesArrayToSourceImages = /**
         * @param {?} fileList
         * @return {?}
         */
            function (fileList) {
                return rxjs.Observable.create(function (observer) {
                    /** @type {?} */
                    var total = fileList.length;
                    fileList.forEach(function (fileItem) {
                        /** @type {?} */
                        var imageResult = new SourceImage();
                        console.log(fileItem.name);
                        // imageResult.fileName = fileItem.name;
                        imageResult.imageObjectUrl = URL.createObjectURL(fileItem);
                        ImageUtilityService.fileToDataURL(fileItem).then(function (result) {
                            imageResult.imageDataUrl = result;
                            observer.next(imageResult);
                            if (--total === 0)
                                observer.complete();
                        });
                    });
                });
            };
        return ImageUtilityService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var ImageCompressService = /** @class */ (function () {
        function ImageCompressService() {
        }
        /**
         * @private
         * @param {?} sourceImgObj
         * @param {?} options
         * @return {?}
         */
        ImageCompressService.jicCompress = /**
         * @private
         * @param {?} sourceImgObj
         * @param {?} options
         * @return {?}
         */
            function (sourceImgObj, options) {
                /** @type {?} */
                var outputFormat = options.Resize_Type;
                /** @type {?} */
                var quality = options.Resize_Quality || 50;
                /** @type {?} */
                var mimeType = 'image/jpeg';
                if (outputFormat !== undefined && outputFormat === 'png') {
                    mimeType = 'image/png';
                }
                /** @type {?} */
                var maxHeight = options.Resize_Max_Height || 300;
                /** @type {?} */
                var maxWidth = options.Resize_Max_Width || 250;
                console.log('MAX Width n Height');
                console.log(options.Resize_Max_Height);
                console.log(options.Resize_Max_Width);
                console.log('Quality');
                console.log(quality);
                /** @type {?} */
                var height = sourceImgObj.height;
                /** @type {?} */
                var width = sourceImgObj.width;
                // calculate the width and height, constraining the proportions
                if (width > height) {
                    if (width > maxWidth) {
                        height = Math.round(height *= maxWidth / width);
                        width = maxWidth;
                    }
                }
                else {
                    if (height > maxHeight) {
                        width = Math.round(width *= maxHeight / height);
                        height = maxHeight;
                    }
                }
                console.log('CVS Width n Height');
                console.log(width);
                console.log(height);
                console.log('Quality');
                console.log(quality);
                /** @type {?} */
                var cvs = document.createElement('canvas');
                cvs.width = width;
                cvs.height = height;
                /** @type {?} */
                var ctx = cvs.getContext('2d').drawImage(sourceImgObj, 0, 0, width, height);
                /** @type {?} */
                var newImageData = cvs.toDataURL(mimeType, quality / 100);
                /** @type {?} */
                var resultImageObj = new Image();
                resultImageObj.src = newImageData;
                return resultImageObj.src;
            };
        /**
         * @param {?} sourceImage
         * @param {?} options
         * @param {?} callback
         * @return {?}
         */
        ImageCompressService.compressImage = /**
         * @param {?} sourceImage
         * @param {?} options
         * @param {?} callback
         * @return {?}
         */
            function (sourceImage, options, callback) {
                /** @type {?} */
                var that = this;
                ImageUtilityService.createImage(sourceImage.imageDataUrl, function (image) {
                    /** @type {?} */
                    var dataURLcompressed = that.jicCompress(image, options);
                    sourceImage.compressedImage = {
                        fileName: sourceImage.fileName,
                        imageObjectUrl: "",
                        imageDataUrl: dataURLcompressed,
                        type: dataURLcompressed.match(/:(.+\/.+);/)[1],
                        compressedImage: null
                    };
                    callback(sourceImage);
                });
            };
        /**
         * @param {?} fileList
         * @param {?} option
         * @return {?}
         */
        ImageCompressService.filesToCompressedImageSourceEx = /**
         * @param {?} fileList
         * @param {?} option
         * @return {?}
         */
            function (fileList, option) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = fileList.length;
                    /** @type {?} */
                    var observer = ImageUtilityService.filesToSourceImages(fileList);
                    /** @type {?} */
                    var images = [];
                    observer.subscribe(function (image) {
                        images.push(image);
                        if (option == null) {
                            option = new ResizeOptions();
                        }
                        ImageCompressService.compressImage(image, option, function (imageRef) {
                            if (--count == 0) {
                                resolve(rxjs.from(images));
                            }
                        });
                    }, function (error) {
                        reject("Error while compressing images");
                    });
                });
            };
        /**
         * @param {?} fileList
         * @return {?}
         */
        ImageCompressService.filesToCompressedImageSource = /**
         * @param {?} fileList
         * @return {?}
         */
            function (fileList) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = fileList.length;
                    /** @type {?} */
                    var observer = ImageUtilityService.filesToSourceImages(fileList);
                    /** @type {?} */
                    var images = [];
                    observer.subscribe(function (image) {
                        images.push(image);
                        ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                            if (--count == 0) {
                                resolve(rxjs.from(images));
                            }
                        });
                    }, function (error) {
                        reject("Error while compressing images");
                    });
                });
            };
        /**
         * @param {?} fileList
         * @param {?} option
         * @return {?}
         */
        ImageCompressService.filesArrayToCompressedImageSourceEx = /**
         * @param {?} fileList
         * @param {?} option
         * @return {?}
         */
            function (fileList, option) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = fileList.length;
                    /** @type {?} */
                    var observer = ImageUtilityService.filesArrayToSourceImages(fileList);
                    /** @type {?} */
                    var images = [];
                    observer.subscribe(function (image) {
                        images.push(image);
                        if (option == null) {
                            option = new ResizeOptions();
                        }
                        ImageCompressService.compressImage(image, option, function (imageRef) {
                            if (--count == 0) {
                                resolve(rxjs.from(images));
                            }
                        });
                    }, function (error) {
                        reject("Error while compressing images");
                    });
                });
            };
        /**
         * @param {?} fileList
         * @return {?}
         */
        ImageCompressService.filesArrayToCompressedImageSource = /**
         * @param {?} fileList
         * @return {?}
         */
            function (fileList) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = fileList.length;
                    /** @type {?} */
                    var observer = ImageUtilityService.filesArrayToSourceImages(fileList);
                    /** @type {?} */
                    var images = [];
                    observer.subscribe(function (image) {
                        images.push(image);
                        ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                            if (--count == 0) {
                                resolve(rxjs.from(images));
                            }
                        });
                    }, function (error) {
                        reject("Error while compressing images");
                    });
                });
            };
        /**
         * @param {?} images
         * @return {?}
         */
        ImageCompressService.IImageListToCompressedImageSource = /**
         * @param {?} images
         * @return {?}
         */
            function (images) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = images.length;
                    images.forEach(function (image) {
                        ImageCompressService.compressImage(image, new ResizeOptions(), function (imageRef) {
                            console.log(image);
                            if (--count == 0) {
                                resolve(images);
                            }
                        });
                    });
                });
            };
        /**
         * @param {?} images
         * @param {?} resizeOption
         * @return {?}
         */
        ImageCompressService.IImageListToCompressedImageSourceEx = /**
         * @param {?} images
         * @param {?} resizeOption
         * @return {?}
         */
            function (images, resizeOption) {
                return new Promise(function (resolve, reject) {
                    /** @type {?} */
                    var count = images.length;
                    images.forEach(function (image) {
                        if (resizeOption == null) {
                            resizeOption = new ResizeOptions();
                        }
                        ImageCompressService.compressImage(image, resizeOption, function (imageRef) {
                            console.log(image);
                            if (--count == 0) {
                                resolve(images);
                            }
                        });
                    });
                });
            };
        ImageCompressService.decorators = [
            { type: i0.Injectable, args: [{
                        providedIn: 'root'
                    },] }
        ];
        /** @nocollapse */ ImageCompressService.ngInjectableDef = i0.defineInjectable({ factory: function ImageCompressService_Factory() { return new ImageCompressService(); }, token: ImageCompressService, providedIn: "root" });
        return ImageCompressService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var ImageCompressModule = /** @class */ (function () {
        function ImageCompressModule() {
        }
        /**
         * @return {?}
         */
        ImageCompressModule.forRoot = /**
         * @return {?}
         */
            function () {
                return {
                    ngModule: ImageCompressModule,
                    providers: [ImageCompressService, ImageUtilityService]
                };
            };
        ImageCompressModule.decorators = [
            { type: i0.NgModule, args: [{
                        imports: [],
                        providers: [ImageUtilityService, ImageCompressService]
                    },] }
        ];
        return ImageCompressModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */

    exports.ImageCompressService = ImageCompressService;
    exports.ImageCompressModule = ImageCompressModule;
    exports.ResizeOptions = ResizeOptions;
    exports.ImageUtilityService = ImageUtilityService;
    exports.SourceImage = SourceImage;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWltYWdlLWNvbXByZXNzLnVtZC5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vbmcyLWltYWdlLWNvbXByZXNzL2xpYi9SZXNpemVPcHRpb25zLnRzIiwibmc6Ly9uZzItaW1hZ2UtY29tcHJlc3MvbGliL0NvbXByZXNzSW1hZ2UudHMiLCJuZzovL25nMi1pbWFnZS1jb21wcmVzcy9saWIvaW1hZ2VVdGlsaXR5U2VydmljZS50cyIsIm5nOi8vbmcyLWltYWdlLWNvbXByZXNzL2xpYi9uZzItaW1hZ2UtY29tcHJlc3Muc2VydmljZS50cyIsIm5nOi8vbmcyLWltYWdlLWNvbXByZXNzL2xpYi9uZzItaW1hZ2UtY29tcHJlc3MubW9kdWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBSZXNpemVPcHRpb25zIHtcclxuICAgIHB1YmxpYyBSZXNpemVfTWF4X0hlaWdodCA9IDgwMDtcclxuICAgIHB1YmxpYyBSZXNpemVfTWF4X1dpZHRoID0gMTAwMDtcclxuICAgIHB1YmxpYyBSZXNpemVfUXVhbGl0eSA9IDcwO1xyXG4gICAgcHVibGljIFJlc2l6ZV9UeXBlID0gJ2ltYWdlL2pwZyc7XHJcbn1cclxuIiwiZXhwb3J0IGludGVyZmFjZSBJSW1hZ2V7XHJcbiAgICBmaWxlTmFtZTpzdHJpbmdcclxuICAgIGltYWdlT2JqZWN0VXJsOnN0cmluZ1xyXG4gICAgaW1hZ2VEYXRhVXJsOnN0cmluZ1xyXG4gICAgdHlwZTpzdHJpbmdcclxuICAgIGNvbXByZXNzZWRJbWFnZTpJSW1hZ2VcclxufVxyXG5cclxuZXhwb3J0ICBjbGFzcyBTb3VyY2VJbWFnZSBpbXBsZW1lbnRzIElJbWFnZXtcclxuICAgIHB1YmxpYyBmaWxlTmFtZTpzdHJpbmc7XHJcbiAgICBwdWJsaWMgaW1hZ2VPYmplY3RVcmw6c3RyaW5nO1xyXG4gICAgcHVibGljIGltYWdlRGF0YVVybDpzdHJpbmc7XHJcbiAgICBwdWJsaWMgdHlwZTpzdHJpbmc7XHJcbiAgICBwdWJsaWMgY29tcHJlc3NlZEltYWdlOklJbWFnZVxyXG59XHJcbiIsImltcG9ydCB7IFNvdXJjZUltYWdlLCBJSW1hZ2UgfSBmcm9tIFwiLi9Db21wcmVzc0ltYWdlXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBPYnNlcnZlciB9IGZyb20gXCJyeGpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSW1hZ2VVdGlsaXR5U2VydmljZSB7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVJbWFnZSh1cmwsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhpbWFnZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbWFnZS5zcmMgPSB1cmw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBmaWxlVG9EYXRhVVJMKGZpbGUpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGU6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLnRhcmdldC5yZXN1bHQpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbGVzVG9Tb3VyY2VJbWFnZXMoZmlsZUxpc3Q6IEZpbGVMaXN0KTogT2JzZXJ2YWJsZTxJSW1hZ2U+IHtcclxuXHJcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogT2JzZXJ2ZXI8SUltYWdlPikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdG90YWwgPSBmaWxlTGlzdC5sZW5ndGg7XHJcbiAgICAgICAgICAgIEFycmF5LmZyb20oZmlsZUxpc3QpLmZvckVhY2goZmlsZUl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGltYWdlUmVzdWx0OiBJSW1hZ2UgPSBuZXcgU291cmNlSW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpbGVJdGVtLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpbWFnZVJlc3VsdC5maWxlTmFtZSA9IGZpbGVJdGVtLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBpbWFnZVJlc3VsdC50eXBlID0gZmlsZUl0ZW0udHlwZTtcclxuICAgICAgICAgICAgICAgIGltYWdlUmVzdWx0LmltYWdlT2JqZWN0VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlSXRlbSk7XHJcbiAgICAgICAgICAgICAgICBJbWFnZVV0aWxpdHlTZXJ2aWNlLmZpbGVUb0RhdGFVUkwoZmlsZUl0ZW0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlUmVzdWx0LmltYWdlRGF0YVVybCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KGltYWdlUmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoLS10b3RhbCA9PT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbGVzQXJyYXlUb1NvdXJjZUltYWdlcyhmaWxlTGlzdDogRmlsZVtdKTogT2JzZXJ2YWJsZTxJSW1hZ2U+IHtcclxuXHJcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcjogT2JzZXJ2ZXI8SUltYWdlPikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdG90YWwgPSBmaWxlTGlzdC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZpbGVMaXN0LmZvckVhY2goZmlsZUl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGltYWdlUmVzdWx0OiBJSW1hZ2UgPSBuZXcgU291cmNlSW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpbGVJdGVtLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gaW1hZ2VSZXN1bHQuZmlsZU5hbWUgPSBmaWxlSXRlbS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VSZXN1bHQuaW1hZ2VPYmplY3RVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGVJdGVtKTtcclxuICAgICAgICAgICAgICAgIEltYWdlVXRpbGl0eVNlcnZpY2UuZmlsZVRvRGF0YVVSTChmaWxlSXRlbSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VSZXN1bHQuaW1hZ2VEYXRhVXJsID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaW1hZ2VSZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgtLXRvdGFsID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnOyBcbmltcG9ydCB7IFJlc2l6ZU9wdGlvbnMgfSBmcm9tIFwiLi9SZXNpemVPcHRpb25zXCJcbmltcG9ydCB7IFNvdXJjZUltYWdlLCBJSW1hZ2UgfSBmcm9tIFwiLi9Db21wcmVzc0ltYWdlXCI7XG5pbXBvcnQgeyBJbWFnZVV0aWxpdHlTZXJ2aWNlIH0gZnJvbSBcIi4vaW1hZ2VVdGlsaXR5U2VydmljZVwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCIgXG5pbXBvcnQgeyBmcm9tIGFzIE9ic2VydmFibGVmcm9tfSBmcm9tIFwicnhqc1wiO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcblxuZXhwb3J0IGNsYXNzIEltYWdlQ29tcHJlc3NTZXJ2aWNlIHtcblxuICBcblxuICBwcml2YXRlIHN0YXRpYyBqaWNDb21wcmVzcyhzb3VyY2VJbWdPYmosIG9wdGlvbnM6IFJlc2l6ZU9wdGlvbnMpIHtcbiAgICAgIHZhciBvdXRwdXRGb3JtYXQgPSBvcHRpb25zLlJlc2l6ZV9UeXBlO1xuICAgICAgdmFyIHF1YWxpdHkgPSBvcHRpb25zLlJlc2l6ZV9RdWFsaXR5IHx8IDUwO1xuICAgICAgdmFyIG1pbWVUeXBlID0gJ2ltYWdlL2pwZWcnO1xuICAgICAgaWYgKG91dHB1dEZvcm1hdCAhPT0gdW5kZWZpbmVkICYmIG91dHB1dEZvcm1hdCA9PT0gJ3BuZycpIHtcbiAgICAgICAgICBtaW1lVHlwZSA9ICdpbWFnZS9wbmcnO1xuICAgICAgfVxuXG5cbiAgICAgIHZhciBtYXhIZWlnaHQgPSBvcHRpb25zLlJlc2l6ZV9NYXhfSGVpZ2h0IHx8IDMwMDtcbiAgICAgIHZhciBtYXhXaWR0aCA9IG9wdGlvbnMuUmVzaXplX01heF9XaWR0aCB8fCAyNTA7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdNQVggV2lkdGggbiBIZWlnaHQnKTtcbiAgICAgIGNvbnNvbGUubG9nKG9wdGlvbnMuUmVzaXplX01heF9IZWlnaHQpO1xuICAgICAgY29uc29sZS5sb2cob3B0aW9ucy5SZXNpemVfTWF4X1dpZHRoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdRdWFsaXR5Jyk7XG4gICAgICBjb25zb2xlLmxvZyhxdWFsaXR5KTtcblxuICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZUltZ09iai5oZWlnaHQ7XG4gICAgICB2YXIgd2lkdGggPSBzb3VyY2VJbWdPYmoud2lkdGg7XG5cbiAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgd2lkdGggYW5kIGhlaWdodCwgY29uc3RyYWluaW5nIHRoZSBwcm9wb3J0aW9uc1xuICAgICAgaWYgKHdpZHRoID4gaGVpZ2h0KSB7XG4gICAgICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIHtcbiAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZChoZWlnaHQgKj0gbWF4V2lkdGggLyB3aWR0aCk7XG4gICAgICAgICAgICAgIHdpZHRoID0gbWF4V2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICAgaWYgKGhlaWdodCA+IG1heEhlaWdodCkge1xuICAgICAgICAgICAgICB3aWR0aCA9IE1hdGgucm91bmQod2lkdGggKj0gbWF4SGVpZ2h0IC8gaGVpZ2h0KTtcbiAgICAgICAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdDVlMgV2lkdGggbiBIZWlnaHQnKTtcbiAgICAgIGNvbnNvbGUubG9nKHdpZHRoKTtcbiAgICAgIGNvbnNvbGUubG9nKGhlaWdodCk7XG4gICAgICBjb25zb2xlLmxvZygnUXVhbGl0eScpO1xuICAgICAgY29uc29sZS5sb2cocXVhbGl0eSk7XG5cbiAgICAgIHZhciBjdnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIGN2cy53aWR0aCA9IHdpZHRoO1xuICAgICAgY3ZzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgIHZhciBjdHggPSBjdnMuZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2Uoc291cmNlSW1nT2JqLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIHZhciBuZXdJbWFnZURhdGEgPSBjdnMudG9EYXRhVVJMKG1pbWVUeXBlLCBxdWFsaXR5IC8gMTAwKTtcbiAgICAgIHZhciByZXN1bHRJbWFnZU9iaiA9IG5ldyBJbWFnZSgpO1xuICAgICAgcmVzdWx0SW1hZ2VPYmouc3JjID0gbmV3SW1hZ2VEYXRhO1xuICAgICAgcmV0dXJuIHJlc3VsdEltYWdlT2JqLnNyYztcbiAgfVxuXG4gICBcblxuICBwdWJsaWMgc3RhdGljIGNvbXByZXNzSW1hZ2Uoc291cmNlSW1hZ2U6IElJbWFnZSwgb3B0aW9uczogUmVzaXplT3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgIGxldCB0aGF0ID0gdGhpcztcbiAgICAgIEltYWdlVXRpbGl0eVNlcnZpY2UuY3JlYXRlSW1hZ2Uoc291cmNlSW1hZ2UuaW1hZ2VEYXRhVXJsLCBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgICAgICB2YXIgZGF0YVVSTGNvbXByZXNzZWQgPSB0aGF0LmppY0NvbXByZXNzKGltYWdlLCBvcHRpb25zKTtcbiAgICAgICAgICBzb3VyY2VJbWFnZS5jb21wcmVzc2VkSW1hZ2UgPSB7XG4gICAgICAgICAgICAgIGZpbGVOYW1lOiBzb3VyY2VJbWFnZS5maWxlTmFtZSxcbiAgICAgICAgICAgICAgaW1hZ2VPYmplY3RVcmw6IFwiXCIsXG4gICAgICAgICAgICAgIGltYWdlRGF0YVVybDogZGF0YVVSTGNvbXByZXNzZWQsXG4gICAgICAgICAgICAgIHR5cGU6IGRhdGFVUkxjb21wcmVzc2VkLm1hdGNoKC86KC4rXFwvLispOy8pWzFdLFxuICAgICAgICAgICAgICBjb21wcmVzc2VkSW1hZ2U6IG51bGxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNhbGxiYWNrKHNvdXJjZUltYWdlKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBmaWxlc1RvQ29tcHJlc3NlZEltYWdlU291cmNlRXgoZmlsZUxpc3Q6IEZpbGVMaXN0LCBvcHRpb246IFJlc2l6ZU9wdGlvbnMpOiBQcm9taXNlPE9ic2VydmFibGU8SUltYWdlPj4ge1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8T2JzZXJ2YWJsZTxJSW1hZ2U+PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgbGV0IGNvdW50ID0gZmlsZUxpc3QubGVuZ3RoO1xuICAgICAgICAgIGxldCBvYnNlcnZlciA9IEltYWdlVXRpbGl0eVNlcnZpY2UuZmlsZXNUb1NvdXJjZUltYWdlcyhmaWxlTGlzdCk7XG4gICAgICAgICAgbGV0IGltYWdlczogQXJyYXk8SUltYWdlPiA9IFtdO1xuICAgICAgICAgIG9ic2VydmVyLnN1YnNjcmliZSgoaW1hZ2UpID0+IHtcbiAgICAgICAgICAgICAgaW1hZ2VzLnB1c2goaW1hZ2UpO1xuICAgICAgICAgICAgICBpZiAob3B0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIG9wdGlvbiA9IG5ldyBSZXNpemVPcHRpb25zKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgb3B0aW9uLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE9ic2VydmFibGVmcm9tKGltYWdlcykpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgcmVqZWN0KFwiRXJyb3Igd2hpbGUgY29tcHJlc3NpbmcgaW1hZ2VzXCIpO1xuICAgICAgICAgIH0pXG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZmlsZXNUb0NvbXByZXNzZWRJbWFnZVNvdXJjZShmaWxlTGlzdDogRmlsZUxpc3QpOiBQcm9taXNlPE9ic2VydmFibGU8SUltYWdlPj4ge1xuXG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBsZXQgY291bnQgPSBmaWxlTGlzdC5sZW5ndGg7XG4gICAgICAgICAgbGV0IG9ic2VydmVyID0gSW1hZ2VVdGlsaXR5U2VydmljZS5maWxlc1RvU291cmNlSW1hZ2VzKGZpbGVMaXN0KTtcbiAgICAgICAgICBsZXQgaW1hZ2VzOiBBcnJheTxJSW1hZ2U+ID0gW107XG4gICAgICAgICAgb2JzZXJ2ZXIuc3Vic2NyaWJlKChpbWFnZSkgPT4ge1xuICAgICAgICAgICAgICBpbWFnZXMucHVzaChpbWFnZSk7XG5cbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgbmV3IFJlc2l6ZU9wdGlvbnMoKSwgKGltYWdlUmVmKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoLS1jb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShPYnNlcnZhYmxlZnJvbShpbWFnZXMpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgIHJlamVjdChcIkVycm9yIHdoaWxlIGNvbXByZXNzaW5nIGltYWdlc1wiKTtcbiAgICAgICAgICB9KVxuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGZpbGVzQXJyYXlUb0NvbXByZXNzZWRJbWFnZVNvdXJjZUV4KGZpbGVMaXN0OiBGaWxlW10sIG9wdGlvbjogUmVzaXplT3B0aW9ucyk6IFByb21pc2U8T2JzZXJ2YWJsZTxJSW1hZ2U+PiB7XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBsZXQgY291bnQgPSBmaWxlTGlzdC5sZW5ndGg7XG4gICAgICAgICAgbGV0IG9ic2VydmVyID0gSW1hZ2VVdGlsaXR5U2VydmljZS5maWxlc0FycmF5VG9Tb3VyY2VJbWFnZXMoZmlsZUxpc3QpO1xuICAgICAgICAgIGxldCBpbWFnZXM6IEFycmF5PElJbWFnZT4gPSBbXTtcbiAgICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoKGltYWdlKSA9PiB7XG4gICAgICAgICAgICAgIGltYWdlcy5wdXNoKGltYWdlKTtcbiAgICAgICAgICAgICAgaWYgKG9wdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICBvcHRpb24gPSBuZXcgUmVzaXplT3B0aW9ucygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIEltYWdlQ29tcHJlc3NTZXJ2aWNlLmNvbXByZXNzSW1hZ2UoaW1hZ2UsIG9wdGlvbiwgKGltYWdlUmVmKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoLS1jb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShPYnNlcnZhYmxlZnJvbShpbWFnZXMpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgIHJlamVjdChcIkVycm9yIHdoaWxlIGNvbXByZXNzaW5nIGltYWdlc1wiKTtcbiAgICAgICAgICB9KVxuICAgICAgfSk7XG4gIH1cbiAgcHVibGljIHN0YXRpYyBmaWxlc0FycmF5VG9Db21wcmVzc2VkSW1hZ2VTb3VyY2UoZmlsZUxpc3Q6IEZpbGVbXSk6IFByb21pc2U8T2JzZXJ2YWJsZTxJSW1hZ2U+PiB7XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxPYnNlcnZhYmxlPElJbWFnZT4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBsZXQgY291bnQgPSBmaWxlTGlzdC5sZW5ndGg7XG4gICAgICAgICAgbGV0IG9ic2VydmVyID0gSW1hZ2VVdGlsaXR5U2VydmljZS5maWxlc0FycmF5VG9Tb3VyY2VJbWFnZXMoZmlsZUxpc3QpO1xuICAgICAgICAgIGxldCBpbWFnZXM6IEFycmF5PElJbWFnZT4gPSBbXTtcbiAgICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoKGltYWdlKSA9PiB7XG4gICAgICAgICAgICAgIGltYWdlcy5wdXNoKGltYWdlKTtcbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgbmV3IFJlc2l6ZU9wdGlvbnMoKSwgKGltYWdlUmVmKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoLS1jb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShPYnNlcnZhYmxlZnJvbShpbWFnZXMpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgIHJlamVjdChcIkVycm9yIHdoaWxlIGNvbXByZXNzaW5nIGltYWdlc1wiKTtcbiAgICAgICAgICB9KVxuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIElJbWFnZUxpc3RUb0NvbXByZXNzZWRJbWFnZVNvdXJjZShpbWFnZXM6IElJbWFnZVtdKTogUHJvbWlzZTxJSW1hZ2VbXT4ge1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8SUltYWdlW10+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBsZXQgY291bnQgPSBpbWFnZXMubGVuZ3RoO1xuICAgICAgICAgIGltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgbmV3IFJlc2l6ZU9wdGlvbnMoKSwgKGltYWdlUmVmKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbWFnZSk7XG4gICAgICAgICAgICAgICAgICBpZiAoLS1jb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpbWFnZXMpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIElJbWFnZUxpc3RUb0NvbXByZXNzZWRJbWFnZVNvdXJjZUV4KGltYWdlczogSUltYWdlW10sIHJlc2l6ZU9wdGlvbjogUmVzaXplT3B0aW9ucyk6IFByb21pc2U8SUltYWdlW10+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxJSW1hZ2VbXT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGxldCBjb3VudCA9IGltYWdlcy5sZW5ndGg7XG4gICAgICAgICAgaW1hZ2VzLmZvckVhY2goaW1hZ2UgPT4ge1xuICAgICAgICAgICAgICBpZiAocmVzaXplT3B0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIHJlc2l6ZU9wdGlvbiA9IG5ldyBSZXNpemVPcHRpb25zKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgSW1hZ2VDb21wcmVzc1NlcnZpY2UuY29tcHJlc3NJbWFnZShpbWFnZSwgcmVzaXplT3B0aW9uLCAoaW1hZ2VSZWYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGltYWdlKTtcbiAgICAgICAgICAgICAgICAgIGlmICgtLWNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGltYWdlcyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICB9KTtcbiAgfVxuXG59XG5cbiIsImltcG9ydCB7IE5nTW9kdWxlLE1vZHVsZVdpdGhQcm92aWRlcnMgIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJbWFnZVV0aWxpdHlTZXJ2aWNlIH0gZnJvbSBcIi4vaW1hZ2VVdGlsaXR5U2VydmljZVwiXG5pbXBvcnQgeyBJbWFnZUNvbXByZXNzU2VydmljZSB9IGZyb20gXCIuL25nMi1pbWFnZS1jb21wcmVzcy5zZXJ2aWNlXCJcblxuQE5nTW9kdWxlKHtcbiAgaW1wb3J0czogW1xuICBdLFxuICBwcm92aWRlcnM6IFtJbWFnZVV0aWxpdHlTZXJ2aWNlLEltYWdlQ29tcHJlc3NTZXJ2aWNlIF1cbn0pXG5leHBvcnQgY2xhc3MgSW1hZ2VDb21wcmVzc01vZHVsZSB7IFxuXG4gIHN0YXRpYyBmb3JSb290KCk6IE1vZHVsZVdpdGhQcm92aWRlcnMge1xuICAgIHJldHVybiB7XG4gICAgICAgIG5nTW9kdWxlOiBJbWFnZUNvbXByZXNzTW9kdWxlLFxuICAgICAgICBwcm92aWRlcnM6IFtJbWFnZUNvbXByZXNzU2VydmljZSwgSW1hZ2VVdGlsaXR5U2VydmljZV1cbiAgICB9O1xufVxufVxuIl0sIm5hbWVzIjpbIk9ic2VydmFibGUiLCJPYnNlcnZhYmxlZnJvbSIsIkluamVjdGFibGUiLCJOZ01vZHVsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO1FBQUE7WUFDVyxzQkFBaUIsR0FBRyxHQUFHLENBQUM7WUFDeEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1lBQ3BCLGdCQUFXLEdBQUcsV0FBVyxDQUFDO1NBQ3BDO1FBQUQsb0JBQUM7SUFBRCxDQUFDOzs7Ozs7O1FDR0Q7U0FNQztRQUFELGtCQUFDO0lBQUQsQ0FBQzs7Ozs7O0FDZEQ7UUFJQTtTQTJEQzs7Ozs7O1FBekRpQiwrQkFBVzs7Ozs7WUFBekIsVUFBMEIsR0FBRyxFQUFFLFFBQVE7O29CQUMvQixLQUFLLEdBQUcsSUFBSSxLQUFLLEVBQUU7Z0JBQ3ZCLEtBQUssQ0FBQyxNQUFNLEdBQUc7b0JBQ1gsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNuQixDQUFDO2dCQUNGLEtBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO2FBQ25COzs7OztRQUVhLGlDQUFhOzs7O1lBQTNCLFVBQTRCLElBQUk7Z0JBQzVCLE9BQU8sSUFBSSxPQUFPLENBQU0sVUFBQyxPQUFPOzt3QkFDeEIsTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFO29CQUM3QixNQUFNLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBTTt3QkFD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